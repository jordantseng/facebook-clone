(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{efDq:function(t,e,o){"use strict";o.r(e);var i=o("3Pt+"),r=o("ofXK"),n=o("o0se"),s=o("Dk7Y"),a=o("tyNb"),c=o("0IaG"),l=o("pLZG"),d=o("vkgz"),b=o("eIep"),u=o("fXoL"),p=o("ekhw"),f=o("bTqV");let g=(()=>{class t{constructor(t,e,o){this.data=t,this.fb=e,this.dialogRef=o}ngOnInit(){this.form=this.fb.group({name:[this.data.name,i.j.required]})}close(){this.dialogRef.close()}onEditFormClick(){this.form.invalid||this.dialogRef.close(this.form.value)}}return t.\u0275fac=function(e){return new(e||t)(u.Ob(c.a),u.Ob(i.b),u.Ob(c.g))},t.\u0275cmp=u.Ib({type:t,selectors:[["app-edit-profile"]],decls:10,vars:2,consts:[["mat-dialog-title",""],[3,"formGroup","ngSubmit"],["label","Name",3,"control"],["align","end"],["type","button",1,"mat-raised-button",3,"click"],["type","submit","mat-raised-button","","color","primary"]],template:function(t,e){1&t&&(u.Tb(0,"h2",0),u.xc(1,"Edit Profile"),u.Sb(),u.Tb(2,"form",1),u.bc("ngSubmit",(function(){return e.onEditFormClick()})),u.Tb(3,"mat-dialog-content"),u.Pb(4,"app-input",2),u.Sb(),u.Tb(5,"mat-dialog-actions",3),u.Tb(6,"button",4),u.bc("click",(function(){return e.close()})),u.xc(7," Close "),u.Sb(),u.Tb(8,"button",5),u.xc(9,"Edit"),u.Sb(),u.Sb(),u.Sb()),2&t&&(u.Cb(2),u.kc("formGroup",e.form),u.Cb(2),u.kc("control",e.form.get("name")))},directives:[c.h,i.k,i.g,i.d,c.e,p.a,c.c,f.b],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:1rem}"]}),t})();const h=t=>{const{newPassword:e,confirmedNewPassword:o}=t.value;return t.get("newPassword").dirty&&t.get("confirmedNewPassword").dirty&&e!==o?{passwordNotMatch:!0}:null};var m=o("lJxs"),w=o("JIr8"),P=o("LRne"),v=o("tk/3");let k=(()=>{class t{constructor(t){this.http=t,this.url="/api/user"}updateMyProfile(t){return this.http.put(`${this.url}/me`,t)}validateMyPassword(t){return this.http.post(`${this.url}/me/password`,{currentPassword:t}).pipe(Object(m.a)(t=>null),Object(w.a)(t=>Object(P.a)({invalidPassword:!0})))}updateMyPassword(t){return this.http.patch(`${this.url}/me/password`,t)}updateMyAvatar(t){const e=new FormData;return e.append("avatar",t),this.http.put(`${this.url}/me/avatar`,e)}}return t.\u0275fac=function(e){return new(e||t)(u.Xb(v.b))},t.\u0275prov=u.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),C=(()=>{class t{constructor(t){this.profileService=t,this.validate=t=>this.profileService.validateMyPassword(t.value)}}return t.\u0275fac=function(e){return new(e||t)(u.Xb(k))},t.\u0275prov=u.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var S=o("kmnG");function y(t,e){1&t&&(u.Tb(0,"mat-error"),u.xc(1," Password Not Match "),u.Sb())}function O(t,e){if(1&t&&(u.Tb(0,"div"),u.wc(1,y,2,0,"mat-error",5),u.Sb()),2&t){const t=u.fc();u.Cb(1),u.kc("ngIf",t.form.hasError("passwordNotMatch"))}}let M=(()=>{class t{constructor(t,e,o,i){this.fb=t,this.dialogRef=e,this.validPassword=o}ngOnInit(){this.form=this.fb.group({currentPassword:["",i.j.required,this.validPassword.validate],newPassword:["",i.j.required],confirmedNewPassword:["",i.j.required]},{validators:[h]})}close(){this.dialogRef.close()}onEditFormClick(){this.form.markAllAsTouched(),this.form.invalid||this.dialogRef.close(this.form.value)}}return t.\u0275fac=function(e){return new(e||t)(u.Ob(i.b),u.Ob(c.g),u.Ob(C),u.Ob(c.a))},t.\u0275cmp=u.Ib({type:t,selectors:[["app-edit-password"]],decls:13,vars:6,consts:[["mat-dialog-title",""],[3,"formGroup","ngSubmit"],["label","Current Password","type","password",3,"control"],["label","New Password","type","password",3,"control"],["label","Confrim new password","type","password",3,"control"],[4,"ngIf"],["align","end"],["type","button",1,"mat-raised-button",3,"click"],["type","submit","mat-raised-button","","color","primary",3,"disabled"]],template:function(t,e){1&t&&(u.Tb(0,"h2",0),u.xc(1,"Change Password"),u.Sb(),u.Tb(2,"form",1),u.bc("ngSubmit",(function(){return e.onEditFormClick()})),u.Tb(3,"mat-dialog-content"),u.Pb(4,"app-input",2),u.Pb(5,"app-input",3),u.Pb(6,"app-input",4),u.wc(7,O,2,1,"div",5),u.Sb(),u.Tb(8,"mat-dialog-actions",6),u.Tb(9,"button",7),u.bc("click",(function(){return e.close()})),u.xc(10," Close "),u.Sb(),u.Tb(11,"button",8),u.xc(12," Change "),u.Sb(),u.Sb(),u.Sb()),2&t&&(u.Cb(2),u.kc("formGroup",e.form),u.Cb(2),u.kc("control",e.form.get("currentPassword")),u.Cb(1),u.kc("control",e.form.get("newPassword")),u.Cb(1),u.kc("control",e.form.get("confirmedNewPassword")),u.Cb(1),u.kc("ngIf",e.form.invalid),u.Cb(4),u.kc("disabled",e.form.invalid||e.form.pending))},directives:[c.h,i.k,i.g,i.d,c.e,p.a,r.l,c.c,f.b,S.b],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:1rem}"]}),t})();var T=o("iz3X"),x=o("oYgl"),I=o("rQ3y"),j=o("Wp6s"),_=o("fZDh"),q=o("V7sj");function U(t,e){1&t&&u.Pb(0,"app-spinner")}function D(t,e){1&t&&(u.Tb(0,"p",15),u.xc(1," No posts added yet. "),u.Sb())}function N(t,e){if(1&t){const t=u.Ub();u.Tb(0,"div",2),u.Tb(1,"div",3),u.Tb(2,"mat-card"),u.Tb(3,"div",4),u.Tb(4,"img",5),u.bc("click",(function(){return u.qc(t),u.oc(6).click()})),u.Sb(),u.Tb(5,"input",6,7),u.bc("change",(function(e){return u.qc(t),u.fc().onChangeAvatar(e)})),u.Sb(),u.Sb(),u.Tb(7,"div",8),u.Tb(8,"mat-card-title"),u.xc(9),u.Sb(),u.Tb(10,"mat-card-subtitle"),u.xc(11),u.Sb(),u.Sb(),u.Tb(12,"div",9),u.Tb(13,"button",10),u.bc("click",(function(){return u.qc(t),u.fc().onOpenDetailsModal()})),u.xc(14," Edit Details "),u.Sb(),u.Tb(15,"button",11),u.bc("click",(function(){return u.qc(t),u.fc().onOpenPasswordModal()})),u.xc(16," Change Password "),u.Sb(),u.Sb(),u.Sb(),u.Sb(),u.Tb(17,"div",12),u.Pb(18,"app-create-post"),u.Tb(19,"app-post-list",13),u.bc("deleteClicked",(function(e){return u.qc(t),u.fc().onDeletePost(e)}))("postLiked",(function(e){return u.qc(t),u.fc().onClickLike(e)})),u.Sb(),u.wc(20,D,2,0,"p",14),u.Sb(),u.Sb()}if(2&t){const t=u.fc();u.Cb(4),u.kc("src",t.loggedinUser.avatar,u.rc),u.Cb(5),u.yc(t.loggedinUser.name),u.Cb(2),u.yc(t.loggedinUser.email),u.Cb(8),u.kc("posts",t.posts)("loggedinUser",t.loggedinUser),u.Cb(1),u.kc("ngIf",t.posts.length<=0&&!t.loadingPost)}}const L=[{path:"",component:(()=>{class t{constructor(t,e,o,i,r,n){this.route=t,this.router=e,this.postsService=o,this.profileService=i,this.authService=r,this.dialog=n,this.posts=[]}ngOnInit(){this.userSub=this.authService.user$.subscribe(t=>{this.loadingProfile=!1,this.loggedinUser=t}),this.postSub=this.postsService.posts$.subscribe(t=>{this.loadingPost=!1,this.posts=t}),this.route.queryParamMap.subscribe(()=>{this.loadingPost=!0,this.postsService.fetchMyPosts()})}onDeletePost(t){this.postsService.deleteMyPost(t)}onChangeAvatar(t){this.loadingProfile=!0,this.profileService.updateMyAvatar(t.target.files[0]).subscribe(t=>{this.authService.user$.next(Object.assign(Object.assign({},this.loggedinUser),{avatar:t}))})}onOpenDetailsModal(){const t=new c.d;t.disableClose=!0,t.autoFocus=!0,t.width="500px",t.data={name:this.loggedinUser.name},this.dialog.open(g,t).afterClosed().pipe(Object(l.a)(t=>!!t),Object(d.a)(()=>this.loadingProfile=!0),Object(b.a)(t=>this.profileService.updateMyProfile(Object.assign(Object.assign({},this.loggedinUser),{name:t.name})))).subscribe(t=>{this.authService.user$.next(t),this.reloadPage()})}onOpenPasswordModal(){const t=new c.d;t.disableClose=!0,t.autoFocus=!0,t.width="500px",this.dialog.open(M,t).afterClosed().pipe(Object(l.a)(t=>!!t),Object(d.a)(()=>this.loadingProfile=!0),Object(b.a)(t=>this.profileService.updateMyPassword(t))).subscribe(()=>{this.loadingProfile=!1})}onClickLike({postId:t}){this.postsService.likePost(t,this.loggedinUser._id)}ngOnDestroy(){this.userSub.unsubscribe(),this.postSub.unsubscribe()}reloadPage(){this.router.navigate(["./"],{relativeTo:this.route,queryParams:{ts:Date.now().toString()},skipLocationChange:!0,queryParamsHandling:"merge"})}}return t.\u0275fac=function(e){return new(e||t)(u.Ob(a.a),u.Ob(a.b),u.Ob(T.a),u.Ob(k),u.Ob(x.a),u.Ob(c.b))},t.\u0275cmp=u.Ib({type:t,selectors:[["app-profile-home"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[1,"profile"],[1,"avatar-container"],["mat-card-avatar","",1,"avatar",3,"src","click"],["hidden","","type","file",3,"change"],["avatar",""],[1,"info"],[1,"card-actions"],["id","edit-details","mat-stroked-button","","onclick","this.blur()",3,"click"],["id","change-password","mat-stroked-button","","onclick","this.blur()",3,"click"],[1,"profile-right"],[3,"posts","loggedinUser","deleteClicked","postLiked"],["class","mat-body-1 info-text",4,"ngIf"],[1,"mat-body-1","info-text"]],template:function(t,e){1&t&&(u.wc(0,U,1,0,"app-spinner",0),u.wc(1,N,21,6,"div",1)),2&t&&(u.kc("ngIf",e.loadingProfile||e.loadingPost),u.Cb(1),u.kc("ngIf",e.loggedinUser&&!e.loadingPost&&!e.loadingProfile))},directives:[r.l,I.a,j.a,j.c,j.i,j.h,f.b,_.a,q.a],styles:[".container[_ngcontent-%COMP%]{display:flex}.avatar-container[_ngcontent-%COMP%]{display:flex;margin-bottom:1rem}.avatar[_ngcontent-%COMP%]{width:100px;height:100px;cursor:pointer;margin:.5rem auto 0}.profile[_ngcontent-%COMP%]{margin:0 1rem 0 0}.profile-right[_ngcontent-%COMP%]{flex:3}mat-card[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky;top:1rem}.info[_ngcontent-%COMP%]{text-align:center}.card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;margin:.5rem 0}"]}),t})()}];let E=(()=>{class t{}return t.\u0275mod=u.Mb({type:t}),t.\u0275inj=u.Lb({factory:function(e){return new(e||t)},imports:[[a.e.forChild(L)],a.e]}),t})();var $=o("rhD1");o.d(e,"ProfileModule",(function(){return F}));let F=(()=>{class t{}return t.\u0275mod=u.Mb({type:t}),t.\u0275inj=u.Lb({factory:function(e){return new(e||t)},imports:[[r.c,E,n.PostsModule,i.i,s.a,$.a]]}),t})()}}]);