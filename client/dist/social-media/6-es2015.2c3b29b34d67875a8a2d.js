(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{efDq:function(t,e,r){"use strict";r.r(e);var i=r("3Pt+"),o=r("ofXK"),n=r("o0se"),s=r("Dk7Y"),a=r("tyNb"),c=r("0IaG"),b=r("pLZG"),d=r("fXoL"),l=r("kmnG"),u=r("qFsG"),f=r("bTqV");function p(t,e){1&t&&(d.Tb(0,"mat-error"),d.xc(1," Name is required. "),d.Sb())}let m=(()=>{class t{constructor(t,e,r){this.data=t,this.fb=e,this.dialogRef=r}ngOnInit(){this.form=this.fb.group({name:[this.data.name,i.j.required]})}close(){this.dialogRef.close()}onEditFormClick(){this.form.invalid||this.dialogRef.close(this.form.value)}}return t.\u0275fac=function(e){return new(e||t)(d.Ob(c.a),d.Ob(i.b),d.Ob(c.g))},t.\u0275cmp=d.Ib({type:t,selectors:[["app-edit-profile"]],decls:14,vars:2,consts:[["mat-dialog-title",""],[3,"formGroup","ngSubmit"],["appearance","fill"],["matInput","","formControlName","name"],[4,"ngIf"],["align","end"],["type","button",1,"mat-raised-button",3,"click"],["type","submit","mat-raised-button","","color","primary"]],template:function(t,e){1&t&&(d.Tb(0,"h2",0),d.xc(1,"Edit Profile"),d.Sb(),d.Tb(2,"form",1),d.bc("ngSubmit",(function(){return e.onEditFormClick()})),d.Tb(3,"mat-dialog-content"),d.Tb(4,"mat-form-field",2),d.Tb(5,"mat-label"),d.xc(6,"Name"),d.Sb(),d.Pb(7,"input",3),d.wc(8,p,2,0,"mat-error",4),d.Sb(),d.Sb(),d.Tb(9,"mat-dialog-actions",5),d.Tb(10,"button",6),d.bc("click",(function(){return e.close()})),d.xc(11," Close "),d.Sb(),d.Tb(12,"button",7),d.xc(13,"Edit"),d.Sb(),d.Sb(),d.Sb()),2&t&&(d.Cb(2),d.kc("formGroup",e.form),d.Cb(6),d.kc("ngIf",e.form.get("name").getError("required")))},directives:[c.h,i.k,i.g,i.d,c.e,l.c,l.g,u.a,i.a,i.f,i.c,o.l,c.c,f.b,l.b],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:1rem}"]}),t})();const g=t=>{const{newPassword:e,confirmedNewPassword:r}=t.value;return t.get("newPassword").dirty&&t.get("confirmedNewPassword").dirty&&e!==r?{passwordNotMatch:!0}:null};var h=r("lJxs"),w=r("JIr8"),v=r("LRne"),S=r("tk/3"),P=r("oYgl");let C=(()=>{class t{constructor(t,e,r){this.http=t,this.router=e,this.authService=r,this.url="/api/user"}updateMyProfile(t){this.http.put(`${this.url}/me`,t).subscribe(t=>{this.authService.user$.next(t),this.reloadPage()})}validateMyPassword(t){return this.http.post(`${this.url}/me/password`,{currentPassword:t}).pipe(Object(h.a)(t=>null),Object(w.a)(t=>Object(v.a)({invalidPassword:!0})))}updateMyPassword(t){this.http.patch(`${this.url}/me/password`,t).subscribe(()=>{this.reloadPage()})}updateMyAvatar(t){const e=new FormData;e.append("avatar",t),this.http.put(`${this.url}/me/avatar`,e).subscribe(t=>{this.authService.user$.next(Object.assign(Object.assign({},this.authService.user$.getValue()),{avatar:t})),this.reloadPage()})}reloadPage(){this.router.navigate(["profile"],{queryParams:{ts:Date.now().toString()},queryParamsHandling:"merge",skipLocationChange:!0})}}return t.\u0275fac=function(e){return new(e||t)(d.Xb(S.b),d.Xb(a.b),d.Xb(P.a))},t.\u0275prov=d.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),k=(()=>{class t{constructor(t){this.profileService=t,this.validate=t=>this.profileService.validateMyPassword(t.value)}}return t.\u0275fac=function(e){return new(e||t)(d.Xb(C))},t.\u0275prov=d.Kb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function T(t,e){1&t&&(d.Rb(0),d.xc(1," Current password is required "),d.Qb())}function y(t,e){1&t&&(d.Rb(0),d.xc(1," Incorrect password "),d.Qb())}function O(t,e){if(1&t&&(d.Tb(0,"mat-error"),d.wc(1,T,2,0,"ng-container",4),d.wc(2,y,2,0,"ng-container",4),d.Sb()),2&t){const t=d.fc();d.Cb(1),d.kc("ngIf",t.form.get("currentPassword").getError("required")),d.Cb(1),d.kc("ngIf",t.form.get("currentPassword").getError("invalidPassword"))}}function M(t,e){1&t&&(d.Tb(0,"mat-hint"),d.xc(1," Validating "),d.Sb())}function x(t,e){1&t&&(d.Tb(0,"mat-error"),d.xc(1," New password is required. "),d.Sb())}function I(t,e){1&t&&(d.Tb(0,"mat-error"),d.xc(1," Confirmed new password is required. "),d.Sb())}function q(t,e){1&t&&(d.Tb(0,"mat-error"),d.xc(1," Password Not Match "),d.Sb())}function N(t,e){if(1&t&&(d.Tb(0,"div"),d.wc(1,q,2,0,"mat-error",4),d.Sb()),2&t){const t=d.fc();d.Cb(1),d.kc("ngIf",t.form.hasError("passwordNotMatch"))}}let j=(()=>{class t{constructor(t,e,r,i){this.fb=t,this.dialogRef=e,this.validPassword=r}ngOnInit(){this.form=this.fb.group({currentPassword:["",i.j.required,this.validPassword.validate],newPassword:["",i.j.required],confirmedNewPassword:["",i.j.required]},{validators:[g]})}close(){this.dialogRef.close()}onEditFormClick(){this.form.markAllAsTouched(),this.form.invalid||this.dialogRef.close(this.form.value)}}return t.\u0275fac=function(e){return new(e||t)(d.Ob(i.b),d.Ob(c.g),d.Ob(k),d.Ob(c.a))},t.\u0275cmp=d.Ib({type:t,selectors:[["app-edit-password"]],decls:29,vars:7,consts:[["mat-dialog-title",""],[3,"formGroup","ngSubmit"],["appearance","fill"],["matInput","","formControlName","currentPassword"],[4,"ngIf"],["matInput","","formControlName","newPassword"],["matInput","","formControlName","confirmedNewPassword"],["align","end"],["type","button",1,"mat-raised-button",3,"click"],["type","submit","mat-raised-button","","color","primary",3,"disabled"]],template:function(t,e){1&t&&(d.Tb(0,"h2",0),d.xc(1,"Change Password"),d.Sb(),d.Tb(2,"form",1),d.bc("ngSubmit",(function(){return e.onEditFormClick()})),d.Tb(3,"mat-dialog-content"),d.Tb(4,"div"),d.Tb(5,"mat-form-field",2),d.Tb(6,"mat-label"),d.xc(7,"Current Password"),d.Sb(),d.Pb(8,"input",3),d.wc(9,O,3,2,"mat-error",4),d.wc(10,M,2,0,"mat-hint",4),d.Sb(),d.Sb(),d.Tb(11,"div"),d.Tb(12,"mat-form-field",2),d.Tb(13,"mat-label"),d.xc(14,"New Password"),d.Sb(),d.Pb(15,"input",5),d.wc(16,x,2,0,"mat-error",4),d.Sb(),d.Sb(),d.Tb(17,"div"),d.Tb(18,"mat-form-field",2),d.Tb(19,"mat-label"),d.xc(20,"Confrim new password"),d.Sb(),d.Pb(21,"input",6),d.wc(22,I,2,0,"mat-error",4),d.Sb(),d.Sb(),d.wc(23,N,2,1,"div",4),d.Sb(),d.Tb(24,"mat-dialog-actions",7),d.Tb(25,"button",8),d.bc("click",(function(){return e.close()})),d.xc(26," Close "),d.Sb(),d.Tb(27,"button",9),d.xc(28," Change "),d.Sb(),d.Sb(),d.Sb()),2&t&&(d.Cb(2),d.kc("formGroup",e.form),d.Cb(7),d.kc("ngIf",e.form.get("currentPassword").invalid),d.Cb(1),d.kc("ngIf",e.form.get("currentPassword").pending),d.Cb(6),d.kc("ngIf",e.form.get("newPassword").getError("required")),d.Cb(6),d.kc("ngIf",e.form.get("confirmedNewPassword").getError("required")),d.Cb(1),d.kc("ngIf",e.form.invalid),d.Cb(4),d.kc("disabled",e.form.invalid||e.form.pending))},directives:[c.h,i.k,i.g,i.d,c.e,l.c,l.g,u.a,i.a,i.f,i.c,o.l,c.c,f.b,l.b,l.f],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:1rem}"]}),t})();var _=r("iz3X"),E=r("rQ3y"),D=r("Wp6s"),U=r("fZDh"),L=r("V7sj");function R(t,e){1&t&&d.Pb(0,"app-spinner")}function $(t,e){1&t&&(d.Tb(0,"p",15),d.xc(1," No posts added yet. "),d.Sb())}function F(t,e){if(1&t){const t=d.Ub();d.Tb(0,"div",2),d.Tb(1,"div",3),d.Tb(2,"mat-card"),d.Tb(3,"div",4),d.Tb(4,"img",5),d.bc("click",(function(){return d.qc(t),d.oc(6).click()})),d.Sb(),d.Tb(5,"input",6,7),d.bc("change",(function(e){return d.qc(t),d.fc().onChangeAvatar(e)})),d.Sb(),d.Sb(),d.Tb(7,"div",8),d.Tb(8,"mat-card-title"),d.xc(9),d.Sb(),d.Tb(10,"mat-card-subtitle"),d.xc(11),d.Sb(),d.Sb(),d.Tb(12,"div",9),d.Tb(13,"button",10),d.bc("click",(function(){return d.qc(t),d.fc().onOpenDetailsModal()})),d.xc(14," Edit Details "),d.Sb(),d.Tb(15,"button",11),d.bc("click",(function(){return d.qc(t),d.fc().onOpenPasswordModal()})),d.xc(16," Change Password "),d.Sb(),d.Sb(),d.Sb(),d.Sb(),d.Tb(17,"div",12),d.Pb(18,"app-create-post"),d.Tb(19,"app-post-list",13),d.bc("deleteClicked",(function(e){return d.qc(t),d.fc().onDeletePost(e)}))("postLiked",(function(e){return d.qc(t),d.fc().onClickLike(e)})),d.Sb(),d.wc(20,$,2,0,"p",14),d.Sb(),d.Sb()}if(2&t){const t=d.fc();d.Cb(4),d.kc("src",t.loggedinUser.avatar,d.rc),d.Cb(5),d.yc(t.loggedinUser.name),d.Cb(2),d.yc(t.loggedinUser.email),d.Cb(8),d.kc("posts",t.posts)("loggedinUser",t.loggedinUser),d.Cb(1),d.kc("ngIf",t.posts.length<=0&&!t.loading)}}const G=[{path:"",component:(()=>{class t{constructor(t,e,r,i,o){this.route=t,this.postsService=e,this.profileService=r,this.authService=i,this.dialog=o,this.posts=[]}ngOnInit(){this.userSub=this.authService.user$.subscribe(t=>{this.loggedinUser=t}),this.postSub=this.postsService.posts$.subscribe(t=>{this.loading=!1,this.posts=t}),this.route.paramMap.subscribe(()=>{this.loading=!0,this.postsService.fetchMyPosts()})}onDeletePost(t){this.loading=!0,this.postsService.deleteMyPost(t)}onChangeAvatar(t){this.loading=!0,this.profileService.updateMyAvatar(t.target.files[0])}onOpenDetailsModal(){const t=new c.d;t.disableClose=!0,t.autoFocus=!0,t.width="500px",t.data={name:this.loggedinUser.name},this.dialog.open(m,t).afterClosed().pipe(Object(b.a)(t=>t)).subscribe(t=>{this.loading=!0,this.profileService.updateMyProfile(Object.assign(Object.assign({},this.loggedinUser),{name:t.name}))})}onOpenPasswordModal(){const t=new c.d;t.disableClose=!0,t.autoFocus=!0,t.width="500px",this.dialog.open(j,t).afterClosed().pipe(Object(b.a)(t=>t)).subscribe(t=>{this.loading=!0,this.profileService.updateMyPassword(t)})}onClickLike({postId:t}){this.postsService.likePost(t,this.loggedinUser._id)}ngOnDestroy(){this.userSub.unsubscribe(),this.userSub.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(d.Ob(a.a),d.Ob(_.a),d.Ob(C),d.Ob(P.a),d.Ob(c.b))},t.\u0275cmp=d.Ib({type:t,selectors:[["app-profile-home"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[1,"profile"],[1,"avatar-container"],["mat-card-avatar","",1,"avatar",3,"src","click"],["hidden","","type","file",3,"change"],["avatar",""],[1,"info"],[1,"card-actions"],["id","edit-details","mat-stroked-button","","onclick","this.blur()",3,"click"],["id","change-password","mat-stroked-button","","onclick","this.blur()",3,"click"],[1,"profile-right"],[3,"posts","loggedinUser","deleteClicked","postLiked"],["class","mat-body-1 info-text",4,"ngIf"],[1,"mat-body-1","info-text"]],template:function(t,e){1&t&&(d.wc(0,R,1,0,"app-spinner",0),d.wc(1,F,21,6,"div",1)),2&t&&(d.kc("ngIf",e.loading),d.Cb(1),d.kc("ngIf",e.loggedinUser&&!e.loading))},directives:[o.l,E.a,D.a,D.c,D.i,D.h,f.b,U.a,L.a],styles:[".container[_ngcontent-%COMP%]{display:flex}.avatar-container[_ngcontent-%COMP%]{display:flex;margin-bottom:1rem}.avatar[_ngcontent-%COMP%]{width:100px;height:100px;cursor:pointer;margin:.5rem auto 0}.profile[_ngcontent-%COMP%]{margin:0 1rem 0 0}.profile-right[_ngcontent-%COMP%]{flex:3}mat-card[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky;top:1rem}.info[_ngcontent-%COMP%]{text-align:center}.card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;margin:.5rem 0}"]}),t})()}];let X=(()=>{class t{}return t.\u0275mod=d.Mb({type:t}),t.\u0275inj=d.Lb({factory:function(e){return new(e||t)},imports:[[a.e.forChild(G)],a.e]}),t})();var A=r("rhD1");r.d(e,"ProfileModule",(function(){return J}));let J=(()=>{class t{}return t.\u0275mod=d.Mb({type:t}),t.\u0275inj=d.Lb({factory:function(e){return new(e||t)},imports:[[o.c,X,n.PostsModule,i.i,s.a,A.a]]}),t})()}}]);