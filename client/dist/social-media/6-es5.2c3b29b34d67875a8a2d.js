function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{efDq:function(t,e,n){"use strict";n.r(e);var r=n("3Pt+"),i=n("ofXK"),o=n("o0se"),a=n("Dk7Y"),s=n("tyNb"),c=n("0IaG"),l=n("pLZG"),u=n("fXoL"),b=n("kmnG"),d=n("qFsG"),f=n("bTqV");function p(t,e){1&t&&(u.Tb(0,"mat-error"),u.xc(1," Name is required. "),u.Sb())}var m,g,h,v=((m=function(){function t(e,n,r){_classCallCheck(this,t),this.data=e,this.fb=n,this.dialogRef=r}return _createClass(t,[{key:"ngOnInit",value:function(){this.form=this.fb.group({name:[this.data.name,r.j.required]})}},{key:"close",value:function(){this.dialogRef.close()}},{key:"onEditFormClick",value:function(){this.form.invalid||this.dialogRef.close(this.form.value)}}]),t}()).\u0275fac=function(t){return new(t||m)(u.Ob(c.a),u.Ob(r.b),u.Ob(c.g))},m.\u0275cmp=u.Ib({type:m,selectors:[["app-edit-profile"]],decls:14,vars:2,consts:[["mat-dialog-title",""],[3,"formGroup","ngSubmit"],["appearance","fill"],["matInput","","formControlName","name"],[4,"ngIf"],["align","end"],["type","button",1,"mat-raised-button",3,"click"],["type","submit","mat-raised-button","","color","primary"]],template:function(t,e){1&t&&(u.Tb(0,"h2",0),u.xc(1,"Edit Profile"),u.Sb(),u.Tb(2,"form",1),u.bc("ngSubmit",(function(){return e.onEditFormClick()})),u.Tb(3,"mat-dialog-content"),u.Tb(4,"mat-form-field",2),u.Tb(5,"mat-label"),u.xc(6,"Name"),u.Sb(),u.Pb(7,"input",3),u.wc(8,p,2,0,"mat-error",4),u.Sb(),u.Sb(),u.Tb(9,"mat-dialog-actions",5),u.Tb(10,"button",6),u.bc("click",(function(){return e.close()})),u.xc(11," Close "),u.Sb(),u.Tb(12,"button",7),u.xc(13,"Edit"),u.Sb(),u.Sb(),u.Sb()),2&t&&(u.Cb(2),u.kc("formGroup",e.form),u.Cb(6),u.kc("ngIf",e.form.get("name").getError("required")))},directives:[c.h,r.k,r.g,r.d,c.e,b.c,b.g,d.a,r.a,r.f,r.c,i.l,c.c,f.b,b.b],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:1rem}"]}),m),w=function(t){var e=t.value,n=e.newPassword,r=e.confirmedNewPassword;return t.get("newPassword").dirty&&t.get("confirmedNewPassword").dirty&&n!==r?{passwordNotMatch:!0}:null},k=n("lJxs"),C=n("JIr8"),P=n("LRne"),S=n("tk/3"),y=n("oYgl"),T=((h=function(){function t(e,n,r){_classCallCheck(this,t),this.http=e,this.router=n,this.authService=r,this.url="/api/user"}return _createClass(t,[{key:"updateMyProfile",value:function(t){var e=this;this.http.put("".concat(this.url,"/me"),t).subscribe((function(t){e.authService.user$.next(t),e.reloadPage()}))}},{key:"validateMyPassword",value:function(t){return this.http.post("".concat(this.url,"/me/password"),{currentPassword:t}).pipe(Object(k.a)((function(t){return null})),Object(C.a)((function(t){return Object(P.a)({invalidPassword:!0})})))}},{key:"updateMyPassword",value:function(t){var e=this;this.http.patch("".concat(this.url,"/me/password"),t).subscribe((function(){e.reloadPage()}))}},{key:"updateMyAvatar",value:function(t){var e=this,n=new FormData;n.append("avatar",t),this.http.put("".concat(this.url,"/me/avatar"),n).subscribe((function(t){e.authService.user$.next(Object.assign(Object.assign({},e.authService.user$.getValue()),{avatar:t})),e.reloadPage()}))}},{key:"reloadPage",value:function(){this.router.navigate(["profile"],{queryParams:{ts:Date.now().toString()},queryParamsHandling:"merge",skipLocationChange:!0})}}]),t}()).\u0275fac=function(t){return new(t||h)(u.Xb(S.b),u.Xb(s.b),u.Xb(y.a))},h.\u0275prov=u.Kb({token:h,factory:h.\u0275fac,providedIn:"root"}),h),O=((g=function t(e){var n=this;_classCallCheck(this,t),this.profileService=e,this.validate=function(t){return n.profileService.validateMyPassword(t.value)}}).\u0275fac=function(t){return new(t||g)(u.Xb(T))},g.\u0275prov=u.Kb({token:g,factory:g.\u0275fac,providedIn:"root"}),g);function M(t,e){1&t&&(u.Rb(0),u.xc(1," Current password is required "),u.Qb())}function x(t,e){1&t&&(u.Rb(0),u.xc(1," Incorrect password "),u.Qb())}function I(t,e){if(1&t&&(u.Tb(0,"mat-error"),u.wc(1,M,2,0,"ng-container",4),u.wc(2,x,2,0,"ng-container",4),u.Sb()),2&t){var n=u.fc();u.Cb(1),u.kc("ngIf",n.form.get("currentPassword").getError("required")),u.Cb(1),u.kc("ngIf",n.form.get("currentPassword").getError("invalidPassword"))}}function _(t,e){1&t&&(u.Tb(0,"mat-hint"),u.xc(1," Validating "),u.Sb())}function q(t,e){1&t&&(u.Tb(0,"mat-error"),u.xc(1," New password is required. "),u.Sb())}function N(t,e){1&t&&(u.Tb(0,"mat-error"),u.xc(1," Confirmed new password is required. "),u.Sb())}function j(t,e){1&t&&(u.Tb(0,"mat-error"),u.xc(1," Password Not Match "),u.Sb())}function E(t,e){if(1&t&&(u.Tb(0,"div"),u.wc(1,j,2,0,"mat-error",4),u.Sb()),2&t){var n=u.fc();u.Cb(1),u.kc("ngIf",n.form.hasError("passwordNotMatch"))}}var D,U=((D=function(){function t(e,n,r,i){_classCallCheck(this,t),this.fb=e,this.dialogRef=n,this.validPassword=r}return _createClass(t,[{key:"ngOnInit",value:function(){this.form=this.fb.group({currentPassword:["",r.j.required,this.validPassword.validate],newPassword:["",r.j.required],confirmedNewPassword:["",r.j.required]},{validators:[w]})}},{key:"close",value:function(){this.dialogRef.close()}},{key:"onEditFormClick",value:function(){this.form.markAllAsTouched(),this.form.invalid||this.dialogRef.close(this.form.value)}}]),t}()).\u0275fac=function(t){return new(t||D)(u.Ob(r.b),u.Ob(c.g),u.Ob(O),u.Ob(c.a))},D.\u0275cmp=u.Ib({type:D,selectors:[["app-edit-password"]],decls:29,vars:7,consts:[["mat-dialog-title",""],[3,"formGroup","ngSubmit"],["appearance","fill"],["matInput","","formControlName","currentPassword"],[4,"ngIf"],["matInput","","formControlName","newPassword"],["matInput","","formControlName","confirmedNewPassword"],["align","end"],["type","button",1,"mat-raised-button",3,"click"],["type","submit","mat-raised-button","","color","primary",3,"disabled"]],template:function(t,e){1&t&&(u.Tb(0,"h2",0),u.xc(1,"Change Password"),u.Sb(),u.Tb(2,"form",1),u.bc("ngSubmit",(function(){return e.onEditFormClick()})),u.Tb(3,"mat-dialog-content"),u.Tb(4,"div"),u.Tb(5,"mat-form-field",2),u.Tb(6,"mat-label"),u.xc(7,"Current Password"),u.Sb(),u.Pb(8,"input",3),u.wc(9,I,3,2,"mat-error",4),u.wc(10,_,2,0,"mat-hint",4),u.Sb(),u.Sb(),u.Tb(11,"div"),u.Tb(12,"mat-form-field",2),u.Tb(13,"mat-label"),u.xc(14,"New Password"),u.Sb(),u.Pb(15,"input",5),u.wc(16,q,2,0,"mat-error",4),u.Sb(),u.Sb(),u.Tb(17,"div"),u.Tb(18,"mat-form-field",2),u.Tb(19,"mat-label"),u.xc(20,"Confrim new password"),u.Sb(),u.Pb(21,"input",6),u.wc(22,N,2,0,"mat-error",4),u.Sb(),u.Sb(),u.wc(23,E,2,1,"div",4),u.Sb(),u.Tb(24,"mat-dialog-actions",7),u.Tb(25,"button",8),u.bc("click",(function(){return e.close()})),u.xc(26," Close "),u.Sb(),u.Tb(27,"button",9),u.xc(28," Change "),u.Sb(),u.Sb(),u.Sb()),2&t&&(u.Cb(2),u.kc("formGroup",e.form),u.Cb(7),u.kc("ngIf",e.form.get("currentPassword").invalid),u.Cb(1),u.kc("ngIf",e.form.get("currentPassword").pending),u.Cb(6),u.kc("ngIf",e.form.get("newPassword").getError("required")),u.Cb(6),u.kc("ngIf",e.form.get("confirmedNewPassword").getError("required")),u.Cb(1),u.kc("ngIf",e.form.invalid),u.Cb(4),u.kc("disabled",e.form.invalid||e.form.pending))},directives:[c.h,r.k,r.g,r.d,c.e,b.c,b.g,d.a,r.a,r.f,r.c,i.l,c.c,f.b,b.b,b.f],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:1rem}"]}),D),L=n("iz3X"),R=n("rQ3y"),F=n("Wp6s"),G=n("fZDh"),X=n("V7sj");function A(t,e){1&t&&u.Pb(0,"app-spinner")}function $(t,e){1&t&&(u.Tb(0,"p",15),u.xc(1," No posts added yet. "),u.Sb())}function J(t,e){if(1&t){var n=u.Ub();u.Tb(0,"div",2),u.Tb(1,"div",3),u.Tb(2,"mat-card"),u.Tb(3,"div",4),u.Tb(4,"img",5),u.bc("click",(function(){return u.qc(n),u.oc(6).click()})),u.Sb(),u.Tb(5,"input",6,7),u.bc("change",(function(t){return u.qc(n),u.fc().onChangeAvatar(t)})),u.Sb(),u.Sb(),u.Tb(7,"div",8),u.Tb(8,"mat-card-title"),u.xc(9),u.Sb(),u.Tb(10,"mat-card-subtitle"),u.xc(11),u.Sb(),u.Sb(),u.Tb(12,"div",9),u.Tb(13,"button",10),u.bc("click",(function(){return u.qc(n),u.fc().onOpenDetailsModal()})),u.xc(14," Edit Details "),u.Sb(),u.Tb(15,"button",11),u.bc("click",(function(){return u.qc(n),u.fc().onOpenPasswordModal()})),u.xc(16," Change Password "),u.Sb(),u.Sb(),u.Sb(),u.Sb(),u.Tb(17,"div",12),u.Pb(18,"app-create-post"),u.Tb(19,"app-post-list",13),u.bc("deleteClicked",(function(t){return u.qc(n),u.fc().onDeletePost(t)}))("postLiked",(function(t){return u.qc(n),u.fc().onClickLike(t)})),u.Sb(),u.wc(20,$,2,0,"p",14),u.Sb(),u.Sb()}if(2&t){var r=u.fc();u.Cb(4),u.kc("src",r.loggedinUser.avatar,u.rc),u.Cb(5),u.yc(r.loggedinUser.name),u.Cb(2),u.yc(r.loggedinUser.email),u.Cb(8),u.kc("posts",r.posts)("loggedinUser",r.loggedinUser),u.Cb(1),u.kc("ngIf",r.posts.length<=0&&!r.loading)}}var V,K,Q=[{path:"",component:(V=function(){function t(e,n,r,i,o){_classCallCheck(this,t),this.route=e,this.postsService=n,this.profileService=r,this.authService=i,this.dialog=o,this.posts=[]}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.userSub=this.authService.user$.subscribe((function(e){t.loggedinUser=e})),this.postSub=this.postsService.posts$.subscribe((function(e){t.loading=!1,t.posts=e})),this.route.paramMap.subscribe((function(){t.loading=!0,t.postsService.fetchMyPosts()}))}},{key:"onDeletePost",value:function(t){this.loading=!0,this.postsService.deleteMyPost(t)}},{key:"onChangeAvatar",value:function(t){this.loading=!0,this.profileService.updateMyAvatar(t.target.files[0])}},{key:"onOpenDetailsModal",value:function(){var t=this,e=new c.d;e.disableClose=!0,e.autoFocus=!0,e.width="500px",e.data={name:this.loggedinUser.name},this.dialog.open(v,e).afterClosed().pipe(Object(l.a)((function(t){return t}))).subscribe((function(e){t.loading=!0,t.profileService.updateMyProfile(Object.assign(Object.assign({},t.loggedinUser),{name:e.name}))}))}},{key:"onOpenPasswordModal",value:function(){var t=this,e=new c.d;e.disableClose=!0,e.autoFocus=!0,e.width="500px",this.dialog.open(U,e).afterClosed().pipe(Object(l.a)((function(t){return t}))).subscribe((function(e){t.loading=!0,t.profileService.updateMyPassword(e)}))}},{key:"onClickLike",value:function(t){var e=t.postId;this.postsService.likePost(e,this.loggedinUser._id)}},{key:"ngOnDestroy",value:function(){this.userSub.unsubscribe(),this.userSub.unsubscribe()}}]),t}(),V.\u0275fac=function(t){return new(t||V)(u.Ob(s.a),u.Ob(L.a),u.Ob(T),u.Ob(y.a),u.Ob(c.b))},V.\u0275cmp=u.Ib({type:V,selectors:[["app-profile-home"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[1,"profile"],[1,"avatar-container"],["mat-card-avatar","",1,"avatar",3,"src","click"],["hidden","","type","file",3,"change"],["avatar",""],[1,"info"],[1,"card-actions"],["id","edit-details","mat-stroked-button","","onclick","this.blur()",3,"click"],["id","change-password","mat-stroked-button","","onclick","this.blur()",3,"click"],[1,"profile-right"],[3,"posts","loggedinUser","deleteClicked","postLiked"],["class","mat-body-1 info-text",4,"ngIf"],[1,"mat-body-1","info-text"]],template:function(t,e){1&t&&(u.wc(0,A,1,0,"app-spinner",0),u.wc(1,J,21,6,"div",1)),2&t&&(u.kc("ngIf",e.loading),u.Cb(1),u.kc("ngIf",e.loggedinUser&&!e.loading))},directives:[i.l,R.a,F.a,F.c,F.i,F.h,f.b,G.a,X.a],styles:[".container[_ngcontent-%COMP%]{display:flex}.avatar-container[_ngcontent-%COMP%]{display:flex;margin-bottom:1rem}.avatar[_ngcontent-%COMP%]{width:100px;height:100px;cursor:pointer;margin:.5rem auto 0}.profile[_ngcontent-%COMP%]{margin:0 1rem 0 0}.profile-right[_ngcontent-%COMP%]{flex:3}mat-card[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky;top:1rem}.info[_ngcontent-%COMP%]{text-align:center}.card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;margin:.5rem 0}"]}),V)}],Y=((K=function t(){_classCallCheck(this,t)}).\u0275mod=u.Mb({type:K}),K.\u0275inj=u.Lb({factory:function(t){return new(t||K)},imports:[[s.e.forChild(Q)],s.e]}),K),Z=n("rhD1");n.d(e,"ProfileModule",(function(){return H}));var z,H=((z=function t(){_classCallCheck(this,t)}).\u0275mod=u.Mb({type:z}),z.\u0275inj=u.Lb({factory:function(t){return new(t||z)},imports:[[i.c,Y,o.PostsModule,r.i,a.a,Z.a]]}),z)}}]);