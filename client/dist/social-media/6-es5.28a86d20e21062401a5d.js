function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{efDq:function(t,e,n){"use strict";n.r(e);var o,i,r,a=n("3Pt+"),s=n("ofXK"),c=n("o0se"),l=n("Dk7Y"),u=n("tyNb"),d=n("0IaG"),b=n("pLZG"),f=n("vkgz"),p=n("eIep"),g=n("fXoL"),h=n("ekhw"),m=n("bTqV"),v=((o=function(){function t(e,n,o){_classCallCheck(this,t),this.data=e,this.fb=n,this.dialogRef=o}return _createClass(t,[{key:"ngOnInit",value:function(){this.form=this.fb.group({name:[this.data.name,a.j.required]})}},{key:"close",value:function(){this.dialogRef.close()}},{key:"onEditFormClick",value:function(){this.form.invalid||this.dialogRef.close(this.form.value)}}]),t}()).\u0275fac=function(t){return new(t||o)(g.Ob(d.a),g.Ob(a.b),g.Ob(d.g))},o.\u0275cmp=g.Ib({type:o,selectors:[["app-edit-profile"]],decls:10,vars:2,consts:[["mat-dialog-title",""],[3,"formGroup","ngSubmit"],["label","Name",3,"control"],["align","end"],["type","button",1,"mat-raised-button",3,"click"],["type","submit","mat-raised-button","","color","primary"]],template:function(t,e){1&t&&(g.Tb(0,"h2",0),g.xc(1,"Edit Profile"),g.Sb(),g.Tb(2,"form",1),g.bc("ngSubmit",(function(){return e.onEditFormClick()})),g.Tb(3,"mat-dialog-content"),g.Pb(4,"app-input",2),g.Sb(),g.Tb(5,"mat-dialog-actions",3),g.Tb(6,"button",4),g.bc("click",(function(){return e.close()})),g.xc(7," Close "),g.Sb(),g.Tb(8,"button",5),g.xc(9,"Edit"),g.Sb(),g.Sb(),g.Sb()),2&t&&(g.Cb(2),g.kc("formGroup",e.form),g.Cb(2),g.kc("control",e.form.get("name")))},directives:[d.h,a.k,a.g,a.d,d.e,h.a,d.c,m.b],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:1rem}"]}),o),k=function(t){var e=t.value,n=e.newPassword,o=e.confirmedNewPassword;return t.get("newPassword").dirty&&t.get("confirmedNewPassword").dirty&&n!==o?{passwordNotMatch:!0}:null},w=n("lJxs"),P=n("JIr8"),C=n("LRne"),y=n("tk/3"),S=((r=function(){function t(e){_classCallCheck(this,t),this.http=e,this.url="/api/user"}return _createClass(t,[{key:"updateMyProfile",value:function(t){return this.http.put("".concat(this.url,"/me"),t)}},{key:"validateMyPassword",value:function(t){return this.http.post("".concat(this.url,"/me/password"),{currentPassword:t}).pipe(Object(w.a)((function(t){return null})),Object(P.a)((function(t){return Object(C.a)({invalidPassword:!0})})))}},{key:"updateMyPassword",value:function(t){return this.http.patch("".concat(this.url,"/me/password"),t)}},{key:"updateMyAvatar",value:function(t){var e=new FormData;return e.append("avatar",t),this.http.put("".concat(this.url,"/me/avatar"),e)}}]),t}()).\u0275fac=function(t){return new(t||r)(g.Xb(y.b))},r.\u0275prov=g.Kb({token:r,factory:r.\u0275fac,providedIn:"root"}),r),O=((i=function t(e){var n=this;_classCallCheck(this,t),this.profileService=e,this.validate=function(t){return n.profileService.validateMyPassword(t.value)}}).\u0275fac=function(t){return new(t||i)(g.Xb(S))},i.\u0275prov=g.Kb({token:i,factory:i.\u0275fac,providedIn:"root"}),i),M=n("kmnG");function T(t,e){1&t&&(g.Tb(0,"mat-error"),g.xc(1," Password Not Match "),g.Sb())}function _(t,e){if(1&t&&(g.Tb(0,"div"),g.wc(1,T,2,0,"mat-error",5),g.Sb()),2&t){var n=g.fc();g.Cb(1),g.kc("ngIf",n.form.hasError("passwordNotMatch"))}}var x,j=((x=function(){function t(e,n,o,i){_classCallCheck(this,t),this.fb=e,this.dialogRef=n,this.validPassword=o}return _createClass(t,[{key:"ngOnInit",value:function(){this.form=this.fb.group({currentPassword:["",a.j.required,this.validPassword.validate],newPassword:["",a.j.required],confirmedNewPassword:["",a.j.required]},{validators:[k]})}},{key:"close",value:function(){this.dialogRef.close()}},{key:"onEditFormClick",value:function(){this.form.markAllAsTouched(),this.form.invalid||this.dialogRef.close(this.form.value)}}]),t}()).\u0275fac=function(t){return new(t||x)(g.Ob(a.b),g.Ob(d.g),g.Ob(O),g.Ob(d.a))},x.\u0275cmp=g.Ib({type:x,selectors:[["app-edit-password"]],decls:13,vars:6,consts:[["mat-dialog-title",""],[3,"formGroup","ngSubmit"],["label","Current Password","type","password",3,"control"],["label","New Password","type","password",3,"control"],["label","Confrim new password","type","password",3,"control"],[4,"ngIf"],["align","end"],["type","button",1,"mat-raised-button",3,"click"],["type","submit","mat-raised-button","","color","primary",3,"disabled"]],template:function(t,e){1&t&&(g.Tb(0,"h2",0),g.xc(1,"Change Password"),g.Sb(),g.Tb(2,"form",1),g.bc("ngSubmit",(function(){return e.onEditFormClick()})),g.Tb(3,"mat-dialog-content"),g.Pb(4,"app-input",2),g.Pb(5,"app-input",3),g.Pb(6,"app-input",4),g.wc(7,_,2,1,"div",5),g.Sb(),g.Tb(8,"mat-dialog-actions",6),g.Tb(9,"button",7),g.bc("click",(function(){return e.close()})),g.xc(10," Close "),g.Sb(),g.Tb(11,"button",8),g.xc(12," Change "),g.Sb(),g.Sb(),g.Sb()),2&t&&(g.Cb(2),g.kc("formGroup",e.form),g.Cb(2),g.kc("control",e.form.get("currentPassword")),g.Cb(1),g.kc("control",e.form.get("newPassword")),g.Cb(1),g.kc("control",e.form.get("confirmedNewPassword")),g.Cb(1),g.kc("ngIf",e.form.invalid),g.Cb(4),g.kc("disabled",e.form.invalid||e.form.pending))},directives:[d.h,a.k,a.g,a.d,d.e,h.a,s.l,d.c,m.b,M.b],styles:["mat-form-field[_ngcontent-%COMP%]{width:100%}mat-dialog-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-left:1rem}"]}),x),I=n("iz3X"),q=n("oYgl"),U=n("rQ3y"),D=n("Wp6s"),N=n("fZDh"),L=n("V7sj");function E(t,e){1&t&&g.Pb(0,"app-spinner")}function F(t,e){1&t&&(g.Tb(0,"p",15),g.xc(1," No posts added yet. "),g.Sb())}function G(t,e){if(1&t){var n=g.Ub();g.Tb(0,"div",2),g.Tb(1,"div",3),g.Tb(2,"mat-card"),g.Tb(3,"div",4),g.Tb(4,"img",5),g.bc("click",(function(){return g.qc(n),g.oc(6).click()})),g.Sb(),g.Tb(5,"input",6,7),g.bc("change",(function(t){return g.qc(n),g.fc().onChangeAvatar(t)})),g.Sb(),g.Sb(),g.Tb(7,"div",8),g.Tb(8,"mat-card-title"),g.xc(9),g.Sb(),g.Tb(10,"mat-card-subtitle"),g.xc(11),g.Sb(),g.Sb(),g.Tb(12,"div",9),g.Tb(13,"button",10),g.bc("click",(function(){return g.qc(n),g.fc().onOpenDetailsModal()})),g.xc(14," Edit Details "),g.Sb(),g.Tb(15,"button",11),g.bc("click",(function(){return g.qc(n),g.fc().onOpenPasswordModal()})),g.xc(16," Change Password "),g.Sb(),g.Sb(),g.Sb(),g.Sb(),g.Tb(17,"div",12),g.Pb(18,"app-create-post"),g.Tb(19,"app-post-list",13),g.bc("deleteClicked",(function(t){return g.qc(n),g.fc().onDeletePost(t)}))("postLiked",(function(t){return g.qc(n),g.fc().onClickLike(t)})),g.Sb(),g.wc(20,F,2,0,"p",14),g.Sb(),g.Sb()}if(2&t){var o=g.fc();g.Cb(4),g.kc("src",o.loggedinUser.avatar,g.rc),g.Cb(5),g.yc(o.loggedinUser.name),g.Cb(2),g.yc(o.loggedinUser.email),g.Cb(8),g.kc("posts",o.posts)("loggedinUser",o.loggedinUser),g.Cb(1),g.kc("ngIf",o.posts.length<=0&&!o.loadingPost)}}var R,A,X=[{path:"",component:(R=function(){function t(e,n,o,i,r,a){_classCallCheck(this,t),this.route=e,this.router=n,this.postsService=o,this.profileService=i,this.authService=r,this.dialog=a,this.posts=[]}return _createClass(t,[{key:"ngOnInit",value:function(){var t=this;this.userSub=this.authService.user$.subscribe((function(e){t.loadingProfile=!1,t.loggedinUser=e})),this.postSub=this.postsService.posts$.subscribe((function(e){t.loadingPost=!1,t.posts=e})),this.route.queryParamMap.subscribe((function(){t.loadingPost=!0,t.postsService.fetchMyPosts()}))}},{key:"onDeletePost",value:function(t){this.postsService.deleteMyPost(t)}},{key:"onChangeAvatar",value:function(t){var e=this;this.loadingProfile=!0,this.profileService.updateMyAvatar(t.target.files[0]).subscribe((function(t){e.authService.user$.next(Object.assign(Object.assign({},e.loggedinUser),{avatar:t}))}))}},{key:"onOpenDetailsModal",value:function(){var t=this,e=new d.d;e.disableClose=!0,e.autoFocus=!0,e.width="500px",e.data={name:this.loggedinUser.name},this.dialog.open(v,e).afterClosed().pipe(Object(b.a)((function(t){return!!t})),Object(f.a)((function(){return t.loadingProfile=!0})),Object(p.a)((function(e){return t.profileService.updateMyProfile(Object.assign(Object.assign({},t.loggedinUser),{name:e.name}))}))).subscribe((function(e){t.authService.user$.next(e),t.reloadPage()}))}},{key:"onOpenPasswordModal",value:function(){var t=this,e=new d.d;e.disableClose=!0,e.autoFocus=!0,e.width="500px",this.dialog.open(j,e).afterClosed().pipe(Object(b.a)((function(t){return!!t})),Object(f.a)((function(){return t.loadingProfile=!0})),Object(p.a)((function(e){return t.profileService.updateMyPassword(e)}))).subscribe((function(){t.loadingProfile=!1}))}},{key:"onClickLike",value:function(t){var e=t.postId;this.postsService.likePost(e,this.loggedinUser._id)}},{key:"ngOnDestroy",value:function(){this.userSub.unsubscribe(),this.postSub.unsubscribe()}},{key:"reloadPage",value:function(){this.router.navigate(["./"],{relativeTo:this.route,queryParams:{ts:Date.now().toString()},skipLocationChange:!0,queryParamsHandling:"merge"})}}]),t}(),R.\u0275fac=function(t){return new(t||R)(g.Ob(u.a),g.Ob(u.b),g.Ob(I.a),g.Ob(S),g.Ob(q.a),g.Ob(d.b))},R.\u0275cmp=g.Ib({type:R,selectors:[["app-profile-home"]],decls:2,vars:2,consts:[[4,"ngIf"],["class","container",4,"ngIf"],[1,"container"],[1,"profile"],[1,"avatar-container"],["mat-card-avatar","",1,"avatar",3,"src","click"],["hidden","","type","file",3,"change"],["avatar",""],[1,"info"],[1,"card-actions"],["id","edit-details","mat-stroked-button","","onclick","this.blur()",3,"click"],["id","change-password","mat-stroked-button","","onclick","this.blur()",3,"click"],[1,"profile-right"],[3,"posts","loggedinUser","deleteClicked","postLiked"],["class","mat-body-1 info-text",4,"ngIf"],[1,"mat-body-1","info-text"]],template:function(t,e){1&t&&(g.wc(0,E,1,0,"app-spinner",0),g.wc(1,G,21,6,"div",1)),2&t&&(g.kc("ngIf",e.loadingProfile||e.loadingPost),g.Cb(1),g.kc("ngIf",e.loggedinUser&&!e.loadingPost&&!e.loadingProfile))},directives:[s.l,U.a,D.a,D.c,D.i,D.h,m.b,N.a,L.a],styles:[".container[_ngcontent-%COMP%]{display:flex}.avatar-container[_ngcontent-%COMP%]{display:flex;margin-bottom:1rem}.avatar[_ngcontent-%COMP%]{width:100px;height:100px;cursor:pointer;margin:.5rem auto 0}.profile[_ngcontent-%COMP%]{margin:0 1rem 0 0}.profile-right[_ngcontent-%COMP%]{flex:3}mat-card[_ngcontent-%COMP%]{position:-webkit-sticky;position:sticky;top:1rem}.info[_ngcontent-%COMP%]{text-align:center}.card-actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;margin:.5rem 0}"]}),R)}],J=((A=function t(){_classCallCheck(this,t)}).\u0275mod=g.Mb({type:A}),A.\u0275inj=g.Lb({factory:function(t){return new(t||A)},imports:[[u.e.forChild(X)],u.e]}),A),$=n("rhD1");n.d(e,"ProfileModule",(function(){return z}));var K,z=((K=function t(){_classCallCheck(this,t)}).\u0275mod=g.Mb({type:K}),K.\u0275inj=g.Lb({factory:function(t){return new(t||K)},imports:[[s.c,J,c.PostsModule,a.i,l.a,$.a]]}),K)}}]);